<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Quest Tracker</title>

    <!-- PWA Meta Tags -->
    <meta name="application-name" content="Daily Quest Tracker">
    <meta name="description" content="Gamified daily habit tracker. Track. Complete. Level Up.">
    <meta name="theme-color" content="#0f0f23">
    <meta name="background-color" content="#0f0f23">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DailyQuest">
    <meta name="msapplication-TileColor" content="#0f0f23">

    <!-- PWA Icons (inline SVG as data URIs) -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' rx='32' fill='%230f0f23'/><text x='96' y='130' font-size='110' text-anchor='middle'>âš¡</text></svg>">

    <!-- PWA Manifest (inline) -->
    <link rel="manifest" href="data:application/manifest+json,{
      %22name%22: %22Daily Quest Tracker%22,
      %22short_name%22: %22DailyQuest%22,
      %22description%22: %22Gamified daily habit tracker. Track. Complete. Level Up.%22,
      %22start_url%22: %22.%22,
      %22display%22: %22standalone%22,
      %22background_color%22: %22%230f0f23%22,
      %22theme_color%22: %22%230f0f23%22,
      %22orientation%22: %22portrait%22,
      %22icons%22: [
        {
          %22src%22: %22data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' rx='32' fill='%230f0f23'/><text x='96' y='130' font-size='110' text-anchor='middle'>âš¡</text></svg>%22,
          %22sizes%22: %22192x192%22,
          %22type%22: %22image/svg+xml%22
        }
      ]
    }">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0f0f23;
            --bg-card: #1a1a35;
            --accent-primary: #00ff88;
            --accent-secondary: #ff0080;
            --accent-warning: #ffd900;
            --text-primary: #e0e0ff;
            --text-dim: #8888aa;
            --border: #2a2a45;
        }

        [data-theme="light"] {
            --bg-dark: #f8f9fa;
            --bg-card: #ffffff;
            --accent-primary: #00b866;
            --accent-secondary: #e6006f;
            --accent-warning: #f5a623;
            --text-primary: #1a1a2e;
            --text-dim: #6b7280;
            --border: #e5e7eb;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(0, 255, 136, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 0, 128, 0.03) 0%, transparent 50%);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        [data-theme="light"] body {
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(0, 184, 102, 0.04) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(230, 0, 111, 0.04) 0%, transparent 50%);
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.6s ease-out;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 10px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .theme-toggle:hover {
            border-color: var(--accent-primary);
            transform: rotate(20deg) scale(1.05);
        }

        .theme-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }

        .subtitle {
            font-family: 'Space Mono', monospace;
            color: var(--text-dim);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
            animation: fadeIn 0.8s ease-out 0.2s both;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stat-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0, 255, 136, 0.15);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-primary), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-dim);
            margin-bottom: 8px;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            line-height: 1;
            background: linear-gradient(135deg, var(--accent-primary), #00ddff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-value.warning {
            background: linear-gradient(135deg, var(--accent-warning), #ff8800);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-value.streak {
            background: linear-gradient(135deg, #ff6b00, var(--accent-warning));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2rem;
        }

        .streak-card {
            position: relative;
            overflow: hidden;
        }

        .streak-card::after {
            content: 'ðŸ”¥';
            position: absolute;
            right: -10px;
            bottom: -10px;
            font-size: 4rem;
            opacity: 0.1;
            pointer-events: none;
        }

        .streak-subtitle {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: var(--text-dim);
            text-transform: uppercase;
            margin-top: 4px;
            letter-spacing: 1px;
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            position: relative;
        }

        .progress-calendar-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 0 auto 20px;
            animation: fadeIn 0.8s ease-out 0.3s both;
            flex-wrap: wrap;
        }

        .insight-icon-btn {
            border-color: rgba(255, 217, 0, 0.4) !important;
        }

        .insight-icon-btn:hover {
            border-color: var(--accent-warning) !important;
            background: rgba(255, 217, 0, 0.1) !important;
        }

        .progress-ring svg {
            transform: rotate(-90deg);
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
        }

        .progress-ring .bg {
            stroke: var(--border);
        }

        .progress-ring .progress {
            stroke: url(#gradient);
            transition: stroke-dashoffset 0.8s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: 900;
            text-align: center;
        }

        .calendar-icon-btn {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            flex-shrink: 0;
        }

        .calendar-icon-btn:hover {
            border-color: var(--accent-primary);
            background: rgba(0, 255, 136, 0.1);
            transform: translateY(-2px);
        }

        .calendar-icon-btn:active {
            transform: translateY(0);
        }

        .calendar-tooltip {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-dark);
            color: var(--accent-primary);
            padding: 6px 12px;
            border-radius: 8px;
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            border: 1px solid var(--accent-primary);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.2);
        }

        /* Show tooltip on hover (desktop) */
        .calendar-icon-btn:hover .calendar-tooltip {
            opacity: 1;
        }

        /* Show tooltip on touch/tap (mobile) */
        .calendar-icon-btn:active .calendar-tooltip {
            opacity: 1;
        }

        .calendar-toggle-btn {
            font-size: 0.95rem;
            padding: 10px 24px;
        }

        .habits-section {
            animation: fadeIn 0.8s ease-out 0.4s both;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: 'â–¸';
            color: var(--accent-primary);
        }

        .collapsible-header {
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
            padding: 12px;
            margin: -12px;
            border-radius: 12px;
        }

        .collapsible-header:hover {
            background: rgba(0, 255, 136, 0.05);
        }

        .collapsible-header::before {
            content: '';
        }

        .collapse-icon {
            color: var(--accent-primary);
            font-size: 1rem;
            transition: transform 0.3s ease;
            display: inline-block;
        }

        .collapse-icon.open {
            transform: rotate(90deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, opacity 0.3s ease-out;
            opacity: 0;
        }

        .collapsible-content.open {
            max-height: 2000px;
            opacity: 1;
            transition: max-height 0.5s ease-in, opacity 0.3s ease-in;
        }

        .habit-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .habit-input input {
            flex: 1;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .habit-input input:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
        }

        .habit-input input::placeholder {
            color: var(--text-dim);
        }

        .habit-category-select {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 12px 12px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.95rem;
            outline: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .habit-category-select:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
        }

        .habit-category-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
            opacity: 0.9;
        }

        .habit-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            align-items: center;
        }

        .suggestion-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-right: 5px;
        }

        .suggestion-chip {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 6px 14px;
            font-size: 0.85rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Outfit', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            -webkit-tap-highlight-color: transparent;
        }

        .suggestion-chip:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .suggestion-chip:active {
            transform: translateY(0);
        }

        .btn {
            background: linear-gradient(135deg, var(--accent-primary), #00ddff);
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            color: var(--bg-dark);
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--accent-secondary);
            box-shadow: 0 8px 25px rgba(255, 0, 128, 0.2);
        }

        .habits-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .habit-item {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        .habit-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-primary);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .habit-item:hover {
            border-color: var(--accent-primary);
            transform: translateX(4px);
        }

        .habit-item:hover::before {
            transform: scaleY(1);
        }

        .habit-item.completed {
            border-color: var(--accent-primary);
            background: rgba(0, 255, 136, 0.05);
        }

        .habit-item.completed::before {
            transform: scaleY(1);
        }

        .habit-checkbox {
            width: 28px;
            height: 28px;
            border: 2px solid var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.3s ease;
            background: var(--bg-dark);
        }

        .habit-item.completed .habit-checkbox {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .habit-checkbox::after {
            content: 'âœ“';
            color: var(--bg-dark);
            font-weight: 900;
            font-size: 1.2rem;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
        }

        .habit-item.completed .habit-checkbox::after {
            opacity: 1;
            transform: scale(1);
        }

        .habit-name {
            flex: 1;
            font-weight: 500;
            font-size: 1rem;
        }

        .habit-item.completed .habit-name {
            color: var(--text-dim);
            text-decoration: line-through;
        }

        .habit-actions {
            display: flex;
            gap: 4px;
            margin-left: auto;
        }

        .habit-edit {
            background: transparent;
            border: none;
            color: var(--text-dim);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
            opacity: 0;
            font-size: 1rem;
        }

        .habit-item:hover .habit-edit {
            opacity: 1;
        }

        .habit-edit:hover {
            background: rgba(0, 255, 136, 0.1);
            color: var(--accent-primary);
        }

        .habit-delete {
            background: transparent;
            border: none;
            color: var(--text-dim);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
            opacity: 0;
            font-size: 1.2rem;
        }

        .habit-item:hover .habit-delete {
            opacity: 1;
        }

        .habit-delete:hover {
            background: rgba(255, 0, 128, 0.1);
            color: var(--accent-secondary);
        }

        .habit-name-input {
            flex: 1;
            background: var(--bg-dark);
            border: 2px solid var(--accent-primary);
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-dim);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .date-display {
            font-family: 'Space Mono', monospace;
            text-align: center;
            margin-bottom: 30px;
            color: var(--text-dim);
            font-size: 0.9rem;
            animation: fadeIn 0.8s ease-out 0.1s both;
        }

        .reset-day {
            margin-top: 30px;
            text-align: center;
        }

        .weekly-section {
            margin-top: 50px;
            animation: fadeIn 0.8s ease-out 0.5s both;
        }

        .streak-settings {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        .streak-settings label {
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .streak-settings select {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 6px 12px;
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            cursor: pointer;
            outline: none;
            transition: all 0.3s ease;
        }

        .streak-settings select:hover {
            border-color: var(--accent-primary);
        }

        .streak-settings select:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
        }

        .weekly-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 20px;
        }

        .week-day {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 12px 8px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .week-day::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            background: linear-gradient(180deg, transparent, rgba(0, 255, 136, 0.1));
            transition: height 0.3s ease;
        }

        .week-day:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .week-day.today {
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
        }

        .week-day.completed {
            border-color: var(--accent-primary);
        }

        .week-day.completed::before {
            height: 100%;
        }

        .week-day-name {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            text-transform: uppercase;
            color: var(--text-dim);
            margin-bottom: 8px;
            letter-spacing: 1px;
        }

        .week-day.today .week-day-name {
            color: var(--accent-primary);
            font-weight: 700;
        }

        .week-day-percent {
            font-size: 1.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--text-primary), var(--text-dim));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .week-day.completed .week-day-percent {
            background: linear-gradient(135deg, var(--accent-primary), #00ddff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .week-day-date {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            color: var(--text-dim);
            margin-top: 4px;
        }

        .habit-stats-section {
            margin-top: 50px;
            animation: fadeIn 0.8s ease-out 0.6s both;
        }

        .stats-period-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .period-btn {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 8px 20px;
            color: var(--text-dim);
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .period-btn:hover {
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .period-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: var(--bg-dark);
            font-weight: 700;
        }

        .habit-stat-item {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .habit-stat-item:hover {
            border-color: var(--accent-primary);
            transform: translateX(4px);
        }

        .habit-stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .habit-stat-name {
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .habit-stat-percentage {
            font-family: 'Space Mono', monospace;
            font-size: 1.2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-primary), #00ddff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .habit-stat-percentage.low {
            background: linear-gradient(135deg, var(--accent-secondary), #ff6b00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .habit-stat-bar-container {
            background: var(--bg-dark);
            border-radius: 8px;
            height: 8px;
            overflow: hidden;
            position: relative;
        }

        .habit-stat-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), #00ddff);
            border-radius: 8px;
            transition: width 0.6s ease;
            position: relative;
        }

        .habit-stat-bar.low {
            background: linear-gradient(90deg, var(--accent-secondary), #ff6b00);
        }

        .habit-stat-details {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .habit-stat-count {
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .no-stats {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-dim);
            font-style: italic;
        }

        .stats-trophy {
            display: inline-block;
            margin-left: 8px;
            font-size: 1.2rem;
        }


                .calendar-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        .calendar-nav-btn {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 10px;
            width: 40px;
            height: 40px;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-nav-btn:hover {
            border-color: var(--accent-primary);
            background: rgba(0, 255, 136, 0.1);
        }

        .calendar-month-year {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-primary);
        }

        .calendar-legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            border: 2px solid var(--border);
        }

        .legend-goal {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .legend-partial {
            background: var(--accent-warning);
            border-color: var(--accent-warning);
        }

        .legend-missed {
            background: var(--bg-card);
            border-color: var(--border);
        }

        #calendarGrid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .calendar-day-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-dim);
            text-align: center;
            padding: 10px 4px;
            letter-spacing: 1px;
        }

        .calendar-day {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 12px 8px;
            text-align: center;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .calendar-day:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.2);
        }

        .calendar-day.empty {
            background: transparent;
            border: none;
            cursor: default;
        }

        .calendar-day.empty:hover {
            transform: none;
            box-shadow: none;
        }

        .calendar-day.today {
            border-color: var(--accent-primary);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
        }

        .calendar-day.goal-hit {
            background: rgba(0, 255, 136, 0.15);
            border-color: var(--accent-primary);
        }

        .calendar-day.goal-hit::before {
            content: '';
            position: absolute;
            top: 4px;
            right: 4px;
            width: 8px;
            height: 8px;
            background: var(--accent-primary);
            border-radius: 50%;
        }

        .calendar-day.partial {
            background: rgba(255, 217, 0, 0.1);
            border-color: var(--accent-warning);
        }

        .calendar-day-number {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .calendar-day-percentage {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: var(--text-dim);
        }

        .calendar-day.goal-hit .calendar-day-percentage {
            color: var(--accent-primary);
            font-weight: 700;
        }

        .calendar-day.partial .calendar-day-percentage {
            color: var(--accent-warning);
        }

        .calendar-day.future {
            opacity: 0.3;
            cursor: default;
        }

        .calendar-day.future:hover {
            transform: none;
            box-shadow: none;
        }

        .readme-modal {
            max-height: 90vh;
        }

        .readme-content {
            font-size: 0.95rem;
            line-height: 1.7;
        }

        .readme-section {
            margin-bottom: 30px;
        }

        .readme-section h4 {
            color: var(--accent-primary);
            font-size: 1.2rem;
            margin-bottom: 12px;
            font-weight: 700;
        }

        .readme-section p {
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .readme-section ul {
            margin-left: 20px;
            margin-bottom: 12px;
        }

        .readme-section li {
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .readme-section strong {
            color: var(--accent-primary);
            font-weight: 600;
        }

        .readme-section em {
            color: var(--accent-secondary);
            font-style: italic;
        }

        .app-preview {
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        .preview-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .preview-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .preview-section strong {
            color: var(--accent-primary);
            display: block;
            margin-bottom: 8px;
        }

        .preview-section ul {
            margin-left: 20px;
            margin-top: 8px;
        }

        .preview-section li {
            margin-bottom: 6px;
            font-size: 0.9rem;
        }

        .tech-stack {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .tech-item {
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .tech-item:last-child {
            border-bottom: none;
        }

        .tech-note {
            font-size: 0.9rem;
            color: var(--text-dim);
            font-style: italic;
            margin-top: 10px;
        }

        .research-links li {
            margin-bottom: 12px;
        }

        .research-links a {
            color: var(--accent-primary);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .research-links a:hover {
            color: #00ddff;
            text-decoration: underline;
        }

        .readme-footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            text-align: center;
        }

        .readme-footer p {
            margin-bottom: 10px;
        }

        .readme-tagline {
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-dim);
            font-style: italic;
        }

        .footer {
            margin-top: 60px;
            padding-top: 40px;
            border-top: 1px solid var(--border);
            animation: fadeIn 1s ease-out 0.6s both;
        }

        .footer-content {
            text-align: center;
        }

        .footer-tagline {
            font-weight: 700;
            font-size: 1.1rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            letter-spacing: 1px;
        }

        .footer-text {
            color: var(--text-dim);
            font-size: 0.9rem;
            margin-bottom: 12px;
            font-style: italic;
        }

        .footer-connect {
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-dim);
            letter-spacing: 0.5px;
        }

        .footer-connect a {
            color: var(--accent-primary);
            text-decoration: none;
            font-weight: 700;
            transition: all 0.3s ease;
            position: relative;
        }

        .footer-connect a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--accent-primary);
            transition: width 0.3s ease;
        }

        .footer-connect a:hover {
            color: #00ddff;
        }

        .footer-connect a:hover::after {
            width: 100%;
        }

        .footer-social {
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-dim);
            letter-spacing: 0.5px;
            margin-top: 8px;
        }

        .footer-social a {
            color: var(--accent-primary);
            text-decoration: none;
            font-weight: 700;
            transition: all 0.3s ease;
            position: relative;
        }

        .footer-social a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--accent-primary);
            transition: width 0.3s ease;
        }

        .footer-social a:hover {
            color: #00ddff;
        }

        .footer-social a:hover::after {
            width: 100%;
        }

        .footer-separator {
            margin: 0 8px;
            color: var(--text-dim);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border: 2px solid var(--accent-primary);
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 255, 136, 0.3);
            animation: slideUp 0.3s ease-out;
        }

        .modal-content-wide {
            max-width: 700px;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-dim);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 0, 128, 0.1);
            color: var(--accent-secondary);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-description {
            color: var(--text-dim);
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        .backfill-habits {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .backfill-habit-item {
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        .backfill-habit-item:hover {
            border-color: var(--accent-primary);
        }

        .backfill-habit-item.selected {
            border-color: var(--accent-primary);
            background: rgba(0, 255, 136, 0.05);
        }

        .backfill-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.3s ease;
            background: var(--bg-card);
        }

        .backfill-habit-item.selected .backfill-checkbox {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .backfill-checkbox::after {
            content: 'âœ“';
            color: var(--bg-dark);
            font-weight: 900;
            font-size: 1rem;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
        }

        .backfill-habit-item.selected .backfill-checkbox::after {
            opacity: 1;
            transform: scale(1);
        }

        .backfill-habit-name {
            flex: 1;
            font-weight: 500;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal-footer .btn {
            padding: 10px 20px;
            font-size: 0.9rem;
        }

        @media (max-width: 500px) {
            h1 {
                font-size: 2rem;
            }

            .theme-toggle {
                top: 10px;
                right: 10px;
                width: 36px;
                height: 36px;
            }

            .theme-icon {
                font-size: 1rem;
            }

            .progress-calendar-row {
                display: grid;
                grid-template-columns: auto 1fr auto;
                grid-template-rows: auto auto;
                gap: 10px 12px;
                align-items: center;
                justify-items: center;
            }

            .progress-ring {
                grid-column: 2;
                grid-row: 1 / 3;
            }

            .badges-icon-btn { grid-column: 1; grid-row: 1; }
            .calendar-icon-btn:nth-of-type(2) { grid-column: 3; grid-row: 1; }
            .insight-icon-btn { grid-column: 3; grid-row: 2; }

            .calendar-icon-btn {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }

            .suggestion-chip {
                font-size: 0.8rem;
                padding: 5px 12px;
            }

            .suggestion-label {
                font-size: 0.7rem;
                width: 100%;
                margin-bottom: 5px;
            }

            .modal-content-wide {
                max-width: 95%;
                width: 95%;
            }

            .calendar-controls {
                padding: 0 5px;
            }

            .calendar-month-year {
                font-size: 0.9rem;
            }

            .calendar-nav-btn {
                width: 35px;
                height: 35px;
                font-size: 1.2rem;
            }

            .calendar-legend {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
                padding: 0 10px;
            }

            #calendarGrid {
                gap: 4px;
            }

            .calendar-day-header {
                font-size: 0.65rem;
                padding: 6px 2px;
            }

            .calendar-day {
                min-height: 50px;
                padding: 8px 4px;
            }

            .calendar-day-number {
                font-size: 1rem;
            }

            .calendar-day-percentage {
                font-size: 0.6rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-value {
                font-size: 2rem;
            }

            .weekly-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 6px;
            }

            .week-day {
                padding: 10px 4px;
            }

            .week-day-name {
                font-size: 0.6rem;
            }

            .week-day-percent {
                font-size: 1.2rem;
            }

            .week-day-date {
                font-size: 0.6rem;
            }
        }

        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
        }

        /* â”€â”€ Badges Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .badges-icon-btn {
            border-color: rgba(255, 215, 0, 0.4) !important;
        }

        .badges-icon-btn:hover {
            border-color: #FFD700 !important;
            background: rgba(255, 215, 0, 0.1) !important;
        }

        .share-icon-btn {
            border-color: rgba(0, 184, 255, 0.4) !important;
        }

        .share-icon-btn:hover {
            border-color: #00b8ff !important;
            background: rgba(0, 184, 255, 0.1) !important;
        }

        /* â”€â”€ Share Card Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .share-modal-content {
            max-width: 480px;
        }

        .share-card {
            background: linear-gradient(135deg, #1a1a35 0%, #0f0f23 100%);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            max-width: 540px;
            margin-left: auto;
            margin-right: auto;
        }

        [data-theme="light"] .share-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        }

        .share-card-header {
            text-align: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }

        .share-title {
            font-size: 1.3rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
        }

        .share-subtitle {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .share-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 16px;
        }

        .share-stat-item {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 10px;
            text-align: center;
        }

        .share-stat-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            text-transform: uppercase;
            color: var(--text-dim);
            margin-bottom: 4px;
        }

        .share-stat-value {
            font-size: 1.6rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-primary), #00ddff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .share-streak {
            background: linear-gradient(135deg, #ff6b00, var(--accent-warning));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .share-weekly-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 14px;
        }

        .share-day {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 6px 2px;
            text-align: center;
        }

        .share-day.goal {
            border-color: var(--accent-primary);
            background: rgba(0, 255, 136, 0.1);
        }

        .share-day-name {
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            color: var(--text-dim);
            text-transform: uppercase;
            margin-bottom: 3px;
        }

        .share-day-pct {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .share-footer {
            text-align: center;
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: var(--text-dim);
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }

        .share-actions {
            display: flex;
            gap: 10px;
        }

        .share-actions .btn {
            flex: 1;
        }

        .badges-subtitle {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
            text-align: center;
        }

        .badges-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .badge-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 14px;
            padding: 16px 14px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .badge-card.unlocked {
            border-color: var(--accent-primary);
            background: rgba(0, 255, 136, 0.06);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.1);
        }

        .badge-card.unlocked::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-primary), transparent);
        }

        .badge-card.locked {
            opacity: 0.4;
            filter: grayscale(0.6);
        }

        .badge-icon {
            font-size: 2rem;
            flex-shrink: 0;
            line-height: 1;
        }

        .badge-info { flex: 1; min-width: 0; }

        .badge-name {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .badge-card.unlocked .badge-name { color: var(--accent-primary); }

        .badge-desc {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-status {
            font-size: 1rem;
            flex-shrink: 0;
        }

        /* â”€â”€ Insight Popup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .insight-modal-content {
            max-width: 420px;
            border-color: var(--accent-warning) !important;
            box-shadow: 0 20px 60px rgba(255, 217, 0, 0.2) !important;
        }

        .insight-modal-header {
            padding: 18px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insight-bulb {
            font-size: 1.5rem;
        }

        .insight-modal-label {
            flex: 1;
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            color: var(--accent-warning);
            letter-spacing: 2px;
            font-weight: 700;
        }

        .insight-modal-body {
            padding: 24px 20px 16px;
        }

        .insight-modal-text {
            font-size: 1.15rem;
            font-weight: 600;
            line-height: 1.6;
            color: var(--text-primary);
            margin-bottom: 14px;
        }

        .insight-modal-meta {
            font-family: 'Space Mono', monospace;
            font-size: 0.78rem;
            color: var(--text-dim);
            background: var(--bg-dark);
            border-radius: 8px;
            padding: 10px 14px;
        }

        .insight-modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .insight-modal-footer .btn {
            padding: 10px 18px;
            font-size: 0.9rem;
        }

        /* PWA Install Banner */
        #installBanner {
            position: fixed;
            bottom: -120px;
            left: 0;
            right: 0;
            z-index: 9999;
            padding: 12px 16px;
            transition: bottom 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        #installBanner.visible {
            bottom: 0;
        }

        .install-banner-content {
            background: var(--bg-card);
            border: 2px solid var(--accent-primary);
            border-radius: 16px;
            padding: 14px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 -4px 30px rgba(0, 255, 136, 0.2);
            max-width: 600px;
            margin: 0 auto;
        }

        .install-banner-icon {
            font-size: 1.8rem;
            flex-shrink: 0;
        }

        .install-banner-text {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .install-banner-text strong {
            color: var(--accent-primary);
            font-size: 0.95rem;
        }

        .install-banner-text span {
            color: var(--text-dim);
            font-size: 0.8rem;
            font-family: 'Space Mono', monospace;
        }

        .install-btn {
            background: linear-gradient(135deg, var(--accent-primary), #00ddff);
            border: none;
            border-radius: 10px;
            padding: 8px 18px;
            color: var(--bg-dark);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .install-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
        }

        .install-dismiss {
            background: transparent;
            border: none;
            color: var(--text-dim);
            font-size: 1.1rem;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .install-dismiss:hover {
            background: rgba(255, 0, 128, 0.1);
            color: var(--accent-secondary);
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle Theme">
                <span class="theme-icon" id="themeIcon">â˜€ï¸</span>
            </button>
            <h1>Daily Quest Tracker</h1>
            <p class="subtitle">Level Up Every Day</p>
        </header>

        <div class="date-display" id="dateDisplay"></div>

        <div class="progress-calendar-row">
            <button class="calendar-icon-btn badges-icon-btn" onclick="openBadgesModal()" aria-label="Achievements">
                ðŸ†
                <span class="calendar-tooltip">Achievements</span>
            </button>
            <button class="calendar-icon-btn share-icon-btn" onclick="openShareModal()" aria-label="Share Progress">
                ðŸ“¤
                <span class="calendar-tooltip">Share Progress</span>
            </button>
            <div class="progress-ring">
                <svg width="120" height="120">
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color: #00ff88; stop-opacity: 1" />
                            <stop offset="100%" style="stop-color: #00ddff; stop-opacity: 1" />
                        </linearGradient>
                    </defs>
                    <circle class="bg" cx="60" cy="60" r="52"></circle>
                    <circle class="progress" cx="60" cy="60" r="52" id="progressCircle"></circle>
                </svg>
                <div class="progress-text" id="progressText">0%</div>
            </div>
            <button class="calendar-icon-btn" onclick="openCalendarModal()" aria-label="View Calendar">
                ðŸ“…
                <span class="calendar-tooltip">View Calendar</span>
            </button>
            <button class="calendar-icon-btn insight-icon-btn" onclick="openInsightModal()" aria-label="Habit Insights">
                ðŸ’¡
                <span class="calendar-tooltip">Habit Insights</span>
            </button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Completed</div>
                <div class="stat-value" id="completedCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Missed</div>
                <div class="stat-value warning" id="missedCount">0</div>
            </div>
            <div class="stat-card streak-card">
                <div class="stat-label">ðŸ”¥ Current Streak</div>
                <div class="stat-value streak" id="currentStreak">0</div>
                <div class="streak-subtitle" id="streakSubtitle">days</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ðŸ“ˆ Best Streak</div>
                <div class="stat-value streak" id="bestStreak">0</div>
                <div class="streak-subtitle">days</div>
            </div>
        </div>

        <div class="habits-section">
            <h2 class="section-title">Today's Quests</h2>
            <div class="habit-input">
                <input type="text" id="habitInput" placeholder="Add a new habit..." maxlength="50">
                <select id="habitCategory" class="habit-category-select">
                    <option value="health">ðŸ’ª Health</option>
                    <option value="mind">ðŸ§  Mind</option>
                    <option value="work">ðŸ’¼ Work</option>
                    <option value="social">ðŸ‘¥ Social</option>
                    <option value="other">â­ Other</option>
                </select>
                <button class="btn" onclick="addHabit()">Add</button>
            </div>
            <div class="habit-suggestions" id="habitSuggestions">
                <span class="suggestion-label">Quick add:</span>
                <button class="suggestion-chip" onclick="addSuggestion('Read')">ðŸ“š Read</button>
                <button class="suggestion-chip" onclick="addSuggestion('Journal')">âœï¸ Journal</button>
                <button class="suggestion-chip" onclick="addSuggestion('Workout')">ðŸ’ª Workout</button>
                <button class="suggestion-chip" onclick="addSuggestion('Meditate')">ðŸ§˜ Meditate</button>
                <button class="suggestion-chip" onclick="addSuggestion('Swim')">ðŸŠ Swim</button>
                <button class="suggestion-chip" onclick="addSuggestion('Walk')">ðŸš¶ Walk</button>
                <button class="suggestion-chip" onclick="addSuggestion('Water (8 glasses)')">ðŸ’§ Water</button>
                <button class="suggestion-chip" onclick="addSuggestion('Sleep 8hrs')">ðŸ˜´ Sleep</button>
                <button class="suggestion-chip" onclick="addSuggestion('No Sugar')">ðŸš« No Sugar</button>
                <button class="suggestion-chip" onclick="addSuggestion('Learn')">ðŸŽ“ Learn</button>
            </div>
            <div class="habits-list" id="habitsList"></div>
        </div>

        <div class="reset-day">
            <button class="btn btn-secondary" onclick="resetDay()">Reset Day</button>
        </div>

        <div class="weekly-section">
            <h2 class="section-title collapsible-header" onclick="toggleSection('weeklySection')">
                <span class="collapse-icon" id="weeklyIcon">â–¸</span>
                Weekly Progress
            </h2>
            <div class="collapsible-content" id="weeklySection">
                <div class="streak-settings">
                    <label for="streakThreshold">Streak Goal: </label>
                    <select id="streakThreshold" onchange="updateStreakThreshold()">
                        <option value="50">50%+ completion</option>
                        <option value="70">70%+ completion</option>
                        <option value="80" selected>80%+ completion</option>
                        <option value="90">90%+ completion</option>
                        <option value="100">100% completion</option>
                    </select>
                </div>
                <div class="weekly-grid" id="weeklyGrid"></div>
            </div>
        </div>

        <div class="habit-stats-section">
            <h2 class="section-title collapsible-header" onclick="toggleSection('habitStatsSection')">
                <span class="collapse-icon" id="habitStatsIcon">â–¸</span>
                Habit Performance
            </h2>
            <div class="collapsible-content" id="habitStatsSection">
                <div class="stats-period-selector">
                    <button class="period-btn active" data-period="7" onclick="changeStatsPeriod(7)">7 Days</button>
                    <button class="period-btn" data-period="30" onclick="changeStatsPeriod(30)">30 Days</button>
                    <button class="period-btn" data-period="90" onclick="changeStatsPeriod(90)">90 Days</button>
                </div>
                <div id="habitStatsContainer"></div>
            </div>
        </div>

        <footer class="footer">
            <div class="footer-content">
                <p class="footer-tagline">âš¡ Track. Complete. Level Up. âš¡</p>
                <p class="footer-text">More features & enhancements dropping soon. Stay tuned for the next quest!</p>
                <p class="footer-connect">
                    Built with focus and flow â€¢ 
                    <a href="#" onclick="openReadmeModal(); return false;">ðŸ“– README</a>
                </p>
                <p class="footer-social">
                    Connect on 
                    <a href="https://www.linkedin.com/in/ankan-hore/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
                    <span class="footer-separator">â€¢</span>
                    <a href="https://x.com/This_is_Ankan" target="_blank" rel="noopener noreferrer">X</a>
                    <span class="footer-separator">â€¢</span>
                    <a href="/cdn-cgi/l/email-protection#6b0a05000a050304190e5958532b0c060a020745080406">Email</a>
                </p>
            </div>
        </footer>
    </div>

    <!-- Backfill Modal -->
    <div id="backfillModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="backfillTitle">Backfill Data</h3>
                <button class="modal-close" onclick="closeBackfillModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <p class="modal-description">Select which habits you completed on this day:</p>
                <div id="backfillHabits" class="backfill-habits"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeBackfillModal()">Cancel</button>
                <button class="btn" onclick="saveBackfill()">Save</button>
            </div>
        </div>
    </div>

    <!-- Calendar Modal -->
    <div id="calendarModal" class="modal">
        <div class="modal-content modal-content-wide">
            <div class="modal-header">
                <h3>Monthly Calendar</h3>
                <button class="modal-close" onclick="closeCalendarModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="calendar-controls">
                    <button class="calendar-nav-btn" onclick="changeMonth(-1)">â€¹</button>
                    <div class="calendar-month-year" id="calendarMonthYear"></div>
                    <button class="calendar-nav-btn" onclick="changeMonth(1)">â€º</button>
                </div>
                <div class="calendar-legend">
                    <div class="legend-item">
                        <div class="legend-color legend-goal"></div>
                        <span>Goal Hit</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color legend-partial"></div>
                        <span>Partial</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color legend-missed"></div>
                        <span>No Data</span>
                    </div>
                </div>
                <div id="calendarGrid"></div>
            </div>
        </div>
    </div>

    <!-- Badges Modal -->
    <div id="badgesModal" class="modal">
        <div class="modal-content modal-content-wide">
            <div class="modal-header">
                <h3>ðŸ† Achievements</h3>
                <button class="modal-close" onclick="closeBadgesModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <p class="badges-subtitle">Complete challenges to unlock badges</p>
                <div class="badges-grid" id="badgesGrid"></div>
            </div>
        </div>
    </div>

    <!-- Share Progress Modal -->
    <div id="shareModal" class="modal">
        <div class="modal-content share-modal-content">
            <div class="modal-header">
                <h3>ðŸ“¤ Share Your Progress</h3>
                <button class="modal-close" onclick="closeShareModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="share-card" id="shareCard">
                    <div class="share-card-header">
                        <h2 class="share-title">Daily Quest Tracker</h2>
                        <p class="share-subtitle">Track. Complete. Level Up.</p>
                    </div>
                    <div class="share-stats">
                        <div class="share-stat-item">
                            <div class="share-stat-label">This Week</div>
                            <div class="share-stat-value" id="shareWeekPct">0%</div>
                        </div>
                        <div class="share-stat-item">
                            <div class="share-stat-label">Current Streak</div>
                            <div class="share-stat-value share-streak" id="shareStreak">0ðŸ”¥</div>
                        </div>
                    </div>
                    <div class="share-weekly-grid" id="shareWeeklyGrid"></div>
                    <div class="share-footer">dailyquesttracker.app</div>
                </div>
                <div class="share-actions">
                    <button class="btn" onclick="downloadShareCard()">ðŸ“¥ Download</button>
                    <button class="btn" onclick="shareNative()" id="nativeShareBtn" style="display:none">ðŸ“¤ Share</button>
                    <button class="btn btn-secondary" onclick="copyShareText()">ðŸ“‹ Copy Text</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Insight Popup Modal -->
    <div id="insightModal" class="modal">
        <div class="modal-content insight-modal-content">
            <div class="insight-modal-header">
                <span class="insight-bulb">ðŸ’¡</span>
                <span class="insight-modal-label">HABIT INSIGHT</span>
                <button class="modal-close" onclick="closeInsightModal()">âœ•</button>
            </div>
            <div class="insight-modal-body">
                <p class="insight-modal-text" id="insightModalText"></p>
                <div class="insight-modal-meta" id="insightModalMeta"></div>
            </div>
            <div class="insight-modal-footer">
                <button class="btn btn-secondary" onclick="showNextInsight()">Next Insight â€º</button>
                <button class="btn" onclick="closeInsightModal()">Got it!</button>
            </div>
        </div>
    </div>

    <!-- README Modal -->
    <div id="readmeModal" class="modal">
        <div class="modal-content modal-content-wide readme-modal">
            <div class="modal-header">
                <h3>ðŸ“– Daily Quest Tracker - README</h3>
                <button class="modal-close" onclick="closeReadmeModal()">âœ•</button>
            </div>
            <div class="modal-body readme-content">
                <section class="readme-section">
                    <h4>ðŸŽ¯ What is Daily Quest Tracker?</h4>
                    <p>Daily Quest Tracker is a gamified habit tracking application designed to help individuals build and maintain positive habits through consistent daily tracking, visual feedback, and achievement systems. It transforms the mundane task of habit tracking into an engaging, game-like experience.</p>
                </section>

                <section class="readme-section">
                    <h4>ðŸ“± App Interface Preview</h4>
                    <div class="app-preview">
                        <div class="preview-section">
                            <strong>ðŸŽ¨ Main Dashboard:</strong>
                            <ul>
                                <li><strong>Header:</strong> "Daily Quest Tracker" with gradient text effect and tagline</li>
                                <li><strong>Date Display:</strong> Current date in full format (Thursday, February 13, 2026)</li>
                                <li><strong>Progress Ring:</strong> Circular animated progress indicator showing daily completion percentage</li>
                                <li><strong>Calendar Button:</strong> Quick access to monthly calendar view (ðŸ“… icon)</li>
                            </ul>
                        </div>
                        <div class="preview-section">
                            <strong>ðŸ“Š Stats Dashboard (4 cards):</strong>
                            <ul>
                                <li><strong>Completed:</strong> Number of habits checked off today</li>
                                <li><strong>Missed:</strong> Number of habits not completed (yellow)</li>
                                <li><strong>ðŸ”¥ Current Streak:</strong> Consecutive days hitting your goal</li>
                                <li><strong>ðŸ“ˆ Best Streak:</strong> Your all-time record</li>
                            </ul>
                        </div>
                        <div class="preview-section">
                            <strong>âœ… Today's Quests Section:</strong>
                            <ul>
                                <li><strong>Input Field:</strong> Add custom habits with text input</li>
                                <li><strong>Quick Add Chips:</strong> Pre-made suggestions (Read, Journal, Workout, Meditate, etc.)</li>
                                <li><strong>Habit List:</strong> Interactive checklist with checkboxes, edit (âœŽ) and delete (âœ•) buttons</li>
                                <li><strong>Visual Feedback:</strong> Green highlight on completion, strikethrough text</li>
                            </ul>
                        </div>
                        <div class="preview-section">
                            <strong>ðŸ“Š Collapsible Sections (tap to expand):</strong>
                            <ul>
                                <li><strong>â–¸ Weekly Progress:</strong> Last 7 days with daily percentages, streak goal selector</li>
                                <li><strong>â–¸ Habit Performance:</strong> Individual habit stats (7/30/90 day views), trophy for best performer</li>
                            </ul>
                        </div>
                        <div class="preview-section">
                            <strong>ðŸ“… Monthly Calendar Modal:</strong>
                            <ul>
                                <li><strong>Full Month Grid:</strong> Color-coded days (green = goal hit, yellow = partial, gray = no data)</li>
                                <li><strong>Month Navigation:</strong> Browse past/future months with arrow buttons</li>
                                <li><strong>Interactive:</strong> Click any past day to backfill data</li>
                            </ul>
                        </div>
                        <div class="preview-section">
                            <strong>ðŸŽ¨ Design Elements:</strong>
                            <ul>
                                <li><strong>Color Scheme:</strong> Dark background (#0f0f23) with neon green (#00ff88) and pink (#ff0080) accents</li>
                                <li><strong>Typography:</strong> Outfit for body text, Space Mono for data/numbers</li>
                                <li><strong>Animations:</strong> Smooth fade-ins, hover effects, progress ring animations</li>
                                <li><strong>Theme:</strong> Cyberpunk/gaming aesthetic with "quest" metaphor</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <section class="readme-section">
                    <h4>ðŸ’¡ Why We Built This</h4>
                    <p>Research consistently shows that habit tracking is one of the most effective tools for behavior change:</p>
                    <ul>
                        <li><strong>Accountability:</strong> The simple act of tracking makes you 42% more likely to achieve your goals (American Psychological Association)</li>
                        <li><strong>Visual Progress:</strong> Seeing streaks and completion rates activates dopamine pathways, reinforcing positive behavior</li>
                        <li><strong>Self-Awareness:</strong> Tracking reveals patterns in behavior that would otherwise go unnoticed</li>
                        <li><strong>Motivation:</strong> Gamification elements (streaks, percentages, achievements) tap into our intrinsic motivation systems</li>
                    </ul>
                    <p>We built this to solve the common problem: <em>habit tracking apps are either too complex or too boring.</em> Daily Quest Tracker strikes the perfect balance between simplicity and engagement.</p>
                </section>

                <section class="readme-section">
                    <h4>ðŸ‘¥ Who Is This For?</h4>
                    <ul>
                        <li><strong>Students:</strong> Building study routines, exercise habits, and skill development</li>
                        <li><strong>Professionals:</strong> Maintaining work-life balance, productivity rituals, and career growth habits</li>
                        <li><strong>Entrepreneurs:</strong> Tracking business-building activities, networking, and personal development</li>
                        <li><strong>Health Enthusiasts:</strong> Fitness routines, meditation, nutrition tracking, sleep hygiene</li>
                        <li><strong>Anyone seeking self-improvement:</strong> Building better versions of themselves, one day at a time</li>
                    </ul>
                </section>

                <section class="readme-section">
                    <h4>ðŸ› ï¸ Tech Stack</h4>
                    <div class="tech-stack">
                        <div class="tech-item">
                            <strong>Frontend:</strong> Pure HTML5, CSS3, Vanilla JavaScript (ES6+)
                        </div>
                        <div class="tech-item">
                            <strong>Storage:</strong> Browser localStorage API for persistent data
                        </div>
                        <div class="tech-item">
                            <strong>Design:</strong> Custom CSS with CSS Grid, Flexbox, and CSS animations
                        </div>
                        <div class="tech-item">
                            <strong>Fonts:</strong> Google Fonts (Outfit, Space Mono)
                        </div>
                        <div class="tech-item">
                            <strong>Architecture:</strong> Single-page application (SPA) with modular JavaScript functions
                        </div>
                        <div class="tech-item">
                            <strong>Hosting:</strong> GitHub Pages (static hosting, free and fast)
                        </div>
                    </div>
                    <p class="tech-note"><strong>Why this stack?</strong> Zero dependencies, maximum performance, works offline, no build tools required, easy to maintain and extend.</p>
                </section>

                <section class="readme-section">
                    <h4>ðŸŽ® Key Features</h4>
                    <ul>
                        <li>âœ… <strong>Daily Habit Tracking:</strong> Add, edit, and check off habits with one tap</li>
                        <li>ðŸ“Š <strong>Visual Progress:</strong> Circular progress ring shows daily completion</li>
                        <li>ðŸ”¥ <strong>Streak Tracking:</strong> Current and best streak with customizable goals (50%-100%)</li>
                        <li>ðŸ“… <strong>Monthly Calendar:</strong> Visual overview of your entire month's performance</li>
                        <li>ðŸ“ˆ <strong>Habit Analytics:</strong> Performance stats over 7/30/90 day periods</li>
                        <li>âš¡ <strong>Backfill Capability:</strong> Fill in missed days retroactively</li>
                        <li>ðŸ“± <strong>Mobile-First:</strong> Optimized for phone usage with touch interactions</li>
                        <li>ðŸ’¾ <strong>Persistent Data:</strong> All data saved locally, no account required</li>
                        <li>ðŸŽ¨ <strong>Gamified UX:</strong> Achievements, trophies, and visual rewards</li>
                    </ul>
                </section>

                <section class="readme-section">
                    <h4>ðŸ“ˆ Impact of Regular Usage</h4>
                    <p>Consistent use of habit tracking tools like Daily Quest Tracker has been shown to:</p>
                    <ul>
                        <li><strong>Increase Success Rate:</strong> People who track habits are 2-3x more likely to stick with them long-term</li>
                        <li><strong>Build Self-Discipline:</strong> The practice of daily tracking strengthens executive function and willpower</li>
                        <li><strong>Create Compound Growth:</strong> Small daily improvements (1% better) compound to 37x improvement over a year</li>
                        <li><strong>Reduce Decision Fatigue:</strong> Automated tracking eliminates the mental burden of "did I do it?"</li>
                        <li><strong>Boost Motivation:</strong> Seeing progress creates momentum and positive feedback loops</li>
                        <li><strong>Improve Self-Awareness:</strong> Understanding patterns helps identify triggers and optimize routines</li>
                    </ul>
                </section>

                <section class="readme-section">
                    <h4>ðŸ“š Research & Further Reading</h4>
                    <ul class="research-links">
                        <li>ðŸ“„ <a href="https://jamesclear.com/habit-tracker" target="_blank" rel="noopener noreferrer">The Science of Habit Tracking - James Clear</a></li>
                        <li>ðŸ“„ <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6524446/" target="_blank" rel="noopener noreferrer">Self-Monitoring and Habit Formation - NCBI Research</a></li>
                        <li>ðŸ“„ <a href="https://www.verywellmind.com/how-to-form-new-habits-2795865" target="_blank" rel="noopener noreferrer">How Long Does It Take to Form a Habit? - Verywell Mind</a></li>
                        <li>ðŸŽ¥ <a href="https://www.youtube.com/watch?v=mNeXuCYiE0U" target="_blank" rel="noopener noreferrer">The Science of Habit Formation - YouTube (BetterThanYesterday)</a></li>
                        <li>ðŸŽ¥ <a href="https://www.youtube.com/watch?v=S5fHkPNhCMI" target="_blank" rel="noopener noreferrer">How to Track Your Habits - YouTube (Matt D'Avella)</a></li>
                        <li>ðŸ“– <strong>Book:</strong> "Atomic Habits" by James Clear - The definitive guide to habit formation</li>
                        <li>ðŸ“– <strong>Book:</strong> "The Power of Habit" by Charles Duhigg - Understanding the neuroscience of habits</li>
                        <li>ðŸ“– <strong>Book:</strong> "Tiny Habits" by BJ Fogg - The science of making small changes stick</li>
                    </ul>
                </section>

                <section class="readme-section">
                    <h4>ðŸš€ Future Roadmap</h4>
                    <ul>
                        <li>ðŸ“Š Historical charts and trend analysis</li>
                        <li>ðŸ† Achievement badges and milestone celebrations</li>
                        <li>ðŸ“¤ Export data (CSV, JSON) for external analysis</li>
                        <li>ðŸ”— Social features (optional sharing, accountability partners)</li>
                        <li>ðŸŽ¨ Custom themes and personalization</li>
                        <li>ðŸ“± Progressive Web App (PWA) for offline-first experience</li>
                        <li>ðŸ”” Optional reminders and notifications</li>
                        <li>ðŸ¤ Multi-user sync (optional cloud backup)</li>
                    </ul>
                </section>

                <section class="readme-section">
                    <h4>ðŸ¤ For Investors, Cofounders & Collaborators</h4>
                    <p><strong>Market Opportunity:</strong> The habit tracking and productivity app market is projected to reach $5.8B by 2027, growing at 13.4% CAGR.</p>
                    <p><strong>Competitive Advantages:</strong></p>
                    <ul>
                        <li>Zero friction onboarding (no signup required)</li>
                        <li>Privacy-first (all data local, no servers)</li>
                        <li>Lightweight and fast (works on any device)</li>
                        <li>Unique gamification approach (quest-based metaphor)</li>
                        <li>Open-source potential (community-driven development)</li>
                    </ul>
                    <p><strong>Monetization Potential:</strong> Freemium model, premium analytics, team/enterprise licenses, habit coaching integration, API for third-party apps.</p>
                    <p><strong>Interested in collaborating?</strong> Reach out via the contact links in the footer.</p>
                </section>

                <section class="readme-section">
                    <h4>ðŸ“ License & Contributing</h4>
                    <p>Daily Quest Tracker is currently a personal project by <strong>Ankan Hore</strong>. The codebase demonstrates best practices in:</p>
                    <ul>
                        <li>Clean, modular JavaScript architecture</li>
                        <li>Responsive, mobile-first CSS design</li>
                        <li>User-centric UX/UI design</li>
                        <li>Progressive enhancement principles</li>
                        <li>Accessibility considerations</li>
                    </ul>
                    <p>This project is available for review, learning, and potential collaboration opportunities.</p>
                </section>

                <div class="readme-footer">
                    <p><strong>Built with â¤ï¸ and â˜• by Ankan Hore</strong></p>
                    <p class="readme-tagline">"We are what we repeatedly do. Excellence, then, is not an act, but a habit." - Aristotle</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'habit-tracker-data';
        const WEEKLY_KEY = 'habit-tracker-weekly';
        const BACKFILL_KEY = 'habit-tracker-backfill';
        const STREAK_KEY = 'habit-tracker-streak-threshold';
        const BEST_STREAK_KEY = 'habit-tracker-best-streak';
        const HABIT_HISTORY_KEY = 'habit-tracker-habit-history';
        
        // Habit Categories
        const CATEGORIES = {
            health: { name: 'Health', color: '#00ff88', icon: 'ðŸ’ª' },
            mind: { name: 'Mind', color: '#00ddff', icon: 'ðŸ§ ' },
            work: { name: 'Work', color: '#ffd900', icon: 'ðŸ’¼' },
            social: { name: 'Social', color: '#ff0080', icon: 'ðŸ‘¥' },
            other: { name: 'Other', color: '#8888aa', icon: 'â­' }
        };
        
        let habits = [];
        let currentDate = new Date().toDateString();
        let editingIndex = null;
        let backfillDate = null;
        let backfillSelections = [];
        let streakThreshold = 80;
        let statsPeriod = 7; // Default 7 days
        let calendarMonth = new Date().getMonth(); // 0-11
        let calendarYear = new Date().getFullYear();

        // Load and save best streak
        function loadBestStreak() {
            try {
                const stored = localStorage.getItem(BEST_STREAK_KEY);
                return stored ? parseInt(stored) : 0;
            } catch (e) {
                console.error('Error loading best streak:', e);
                return 0;
            }
        }

        function saveBestStreak(streak) {
            try {
                localStorage.setItem(BEST_STREAK_KEY, streak.toString());
            } catch (e) {
                console.error('Error saving best streak:', e);
            }
        }

        // Load streak threshold
        function loadStreakThreshold() {
            try {
                const stored = localStorage.getItem(STREAK_KEY);
                if (stored) {
                    streakThreshold = parseInt(stored);
                    document.getElementById('streakThreshold').value = streakThreshold;
                }
            } catch (e) {
                console.error('Error loading streak threshold:', e);
            }
        }

        // Load data from localStorage
        function loadData() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    const data = JSON.parse(stored);
                    
                    if (data.date !== currentDate) {
                        saveWeeklyData(data.date, data.habits);
                        habits = data.habits.map(h => ({ name: h.name, completed: false, category: h.category || 'other' }));
                        saveData();
                    } else {
                        habits = data.habits.map(h => ({ ...h, category: h.category || 'other' }));
                    }
                }
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }

        // Save data to localStorage
        function saveData() {
            try {
                const data = {
                    date: currentDate,
                    habits: habits
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                saveWeeklyData(currentDate, habits);
                saveHabitHistory(currentDate, habits);
            } catch (e) {
                console.error('Error saving data:', e);
            }
        }

        // Save habit history for stats
        function saveHabitHistory(date, habitsData) {
            try {
                let history = {};
                const stored = localStorage.getItem(HABIT_HISTORY_KEY);
                if (stored) {
                    history = JSON.parse(stored);
                }
                
                // Store which habits were completed on this date
                const completedHabits = habitsData
                    .filter(h => h.completed)
                    .map(h => h.name);
                
                history[date] = completedHabits;
                
                // Keep only last 90 days
                const dates = Object.keys(history);
                if (dates.length > 90) {
                    dates.sort((a, b) => new Date(a) - new Date(b));
                    dates.slice(0, dates.length - 90).forEach(d => delete history[d]);
                }
                
                localStorage.setItem(HABIT_HISTORY_KEY, JSON.stringify(history));
            } catch (e) {
                console.error('Error saving habit history:', e);
            }
        }

        // Get habit history
        function getHabitHistory() {
            try {
                const stored = localStorage.getItem(HABIT_HISTORY_KEY);
                return stored ? JSON.parse(stored) : {};
            } catch (e) {
                console.error('Error loading habit history:', e);
                return {};
            }
        }

        // Save weekly completion data
        function saveWeeklyData(date, habitsData) {
            try {
                const completed = habitsData.filter(h => h.completed).length;
                const total = habitsData.length;
                const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
                
                let weeklyData = {};
                const stored = localStorage.getItem(WEEKLY_KEY);
                if (stored) {
                    weeklyData = JSON.parse(stored);
                }
                
                weeklyData[date] = {
                    percentage: percentage,
                    completed: completed,
                    total: total
                };
                
                const dates = Object.keys(weeklyData);
                if (dates.length > 30) {
                    dates.sort((a, b) => new Date(a) - new Date(b));
                    dates.slice(0, dates.length - 30).forEach(d => delete weeklyData[d]);
                }
                
                localStorage.setItem(WEEKLY_KEY, JSON.stringify(weeklyData));
            } catch (e) {
                console.error('Error saving weekly data:', e);
            }
        }

        // Get weekly data
        function getWeeklyData() {
            try {
                const stored = localStorage.getItem(WEEKLY_KEY);
                return stored ? JSON.parse(stored) : {};
            } catch (e) {
                console.error('Error loading weekly data:', e);
                return {};
            }
        }

        // Calculate streaks
        function calculateStreaks() {
            const weeklyData = getWeeklyData();
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            let currentStreak = 0;
            let maxStreak = 0;
            let tempStreak = 0;
            
            // Go through last 365 days forward in time to find best streak
            for (let i = 364; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                const data = weeklyData[dateStr];
                
                if (data && data.percentage >= streakThreshold) {
                    tempStreak++;
                    maxStreak = Math.max(maxStreak, tempStreak);
                } else {
                    tempStreak = 0;
                }
            }
            
            // Calculate current streak from today backwards
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                const data = weeklyData[dateStr];
                
                if (data && data.percentage >= streakThreshold) {
                    currentStreak++;
                } else {
                    break;
                }
            }
            
            // Always recalculate from current data (allows decrease when backfilling)
            const bestStreak = maxStreak;
            saveBestStreak(bestStreak);
            
            return { currentStreak, bestStreak };
        }

        // Update streak display
        function updateStreakDisplay() {
            const { currentStreak, bestStreak } = calculateStreaks();
            
            document.getElementById('currentStreak').textContent = currentStreak;
            document.getElementById('bestStreak').textContent = bestStreak;
            
            const subtitle = document.getElementById('streakSubtitle');
            if (currentStreak === 0) {
                subtitle.textContent = 'Start your streak!';
            } else if (currentStreak === 1) {
                subtitle.textContent = 'day - keep going!';
            } else {
                subtitle.textContent = 'days - on fire! ðŸ”¥';
            }
        }

        // Update date display
        function updateDateDisplay() {
            const date = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('dateDisplay').textContent = date.toLocaleDateString('en-US', options);
        }

        // Update streak threshold
        function updateStreakThreshold() {
            streakThreshold = parseInt(document.getElementById('streakThreshold').value);
            try {
                localStorage.setItem(STREAK_KEY, streakThreshold);
            } catch (e) {
                console.error('Error saving streak threshold:', e);
            }
            updateStreakDisplay();
            renderWeeklySummary();
            // Calendar will update legend automatically when opened
        }

        // Update statistics and progress ring
        function updateStats() {
            const completed = habits.filter(h => h.completed).length;
            const total = habits.length;
            const missed = total - completed;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;

            document.getElementById('completedCount').textContent = completed;
            document.getElementById('missedCount').textContent = missed;
            document.getElementById('progressText').textContent = percentage + '%';

            const circle = document.getElementById('progressCircle');
            const radius = 52;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percentage / 100) * circumference;
            
            circle.style.strokeDasharray = circumference;
            circle.style.strokeDashoffset = offset;
            
            renderWeeklySummary();
            updateStreakDisplay();
        }

        // Render weekly summary
        function renderWeeklySummary() {
            const container = document.getElementById('weeklyGrid');
            const weeklyData = getWeeklyData();
            const backfillData = getBackfillData();
            const today = new Date();
            
            const days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                days.push(date);
            }
            
            container.innerHTML = days.map(date => {
                const dateStr = date.toDateString();
                const data = weeklyData[dateStr];
                const percentage = data ? data.percentage : 0;
                const isToday = dateStr === currentDate;
                const isPast = date < today && !isToday;
                const hasData = data && data.total > 0;
                const isBackfilled = backfillData[dateStr] !== undefined;
                const meetsThreshold = percentage >= streakThreshold;
                
                const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                const dayDate = date.getDate();
                
                let className = 'week-day';
                if (isToday) className += ' today';
                if (hasData && meetsThreshold) className += ' completed';
                
                return `
                    <div class="${className}" data-date="${dateStr}" data-past="${isPast}" ${isPast ? 'onclick="openBackfillModal(\'' + dateStr + '\')"' : ''}>
                        <div class="week-day-name">${dayName}${isBackfilled ? ' âš¡' : ''}</div>
                        <div class="week-day-percent">${percentage}%</div>
                        <div class="week-day-date">${dayDate}</div>
                    </div>
                `;
            }).join('');
        }

        // Render habits list
        function renderHabits() {
            const container = document.getElementById('habitsList');
            
            if (habits.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸŽ¯</div>
                        <p>No habits yet. Add your first quest above!</p>
                    </div>
                `;
                updateStats();
                return;
            }

            container.innerHTML = habits.map((habit, index) => {
                const isEditing = editingIndex === index;
                
                return `
                    <div class="habit-item ${habit.completed ? 'completed' : ''}" data-index="${index}">
                        <div class="habit-checkbox"></div>
                        ${isEditing 
                            ? `<input type="text" class="habit-name-input" data-index="${index}" value="${escapeHtml(habit.name)}" maxlength="50">`
                            : `<div class="habit-name">
                                ${escapeHtml(habit.name)}
                                ${habit.category ? `<span class="habit-category-badge" style="background: ${CATEGORIES[habit.category]?.color}20; color: ${CATEGORIES[habit.category]?.color};">${CATEGORIES[habit.category]?.icon} ${CATEGORIES[habit.category]?.name}</span>` : ''}
                              </div>`
                        }
                        <div class="habit-actions">
                            ${isEditing 
                                ? `<button class="habit-edit" data-index="${index}" data-action="save">âœ“</button>`
                                : `<button class="habit-edit" data-index="${index}" data-action="edit">âœŽ</button>`
                            }
                            <button class="habit-delete" data-index="${index}">âœ•</button>
                        </div>
                    </div>
                `;
            }).join('');

            // Add event listeners
            container.querySelectorAll('.habit-item').forEach((item) => {
                const index = parseInt(item.dataset.index);
                const isEditing = editingIndex === index;
                
                if (!isEditing) {
                    item.addEventListener('touchstart', (e) => {
                        if (!e.target.classList.contains('habit-delete') && 
                            !e.target.classList.contains('habit-edit') &&
                            !e.target.closest('.habit-actions')) {
                            e.preventDefault();
                            toggleHabit(index);
                        }
                    }, { passive: false });
                    
                    item.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('habit-delete') && 
                            !e.target.classList.contains('habit-edit') &&
                            !e.target.closest('.habit-actions') &&
                            e.type === 'click') {
                            toggleHabit(index);
                        }
                    });
                }
            });

            // Add edit button listeners
            container.querySelectorAll('.habit-edit').forEach((btn) => {
                const index = parseInt(btn.dataset.index);
                const action = btn.dataset.action;
                
                btn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (action === 'edit') {
                        startEditHabit(index);
                    } else {
                        saveEditHabit(index);
                    }
                }, { passive: false });
                
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (action === 'edit') {
                        startEditHabit(index);
                    } else {
                        saveEditHabit(index);
                    }
                });
            });

            // Add delete button listeners
            container.querySelectorAll('.habit-delete').forEach((btn) => {
                const index = parseInt(btn.dataset.index);
                
                btn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    deleteHabit(index);
                }, { passive: false });
                
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteHabit(index);
                });
            });

            // Add input listeners
            container.querySelectorAll('.habit-name-input').forEach((input) => {
                const index = parseInt(input.dataset.index);
                
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        saveEditHabit(index);
                    }
                });
                
                input.addEventListener('blur', () => {
                    saveEditHabit(index);
                });
                
                setTimeout(() => input.focus(), 0);
            });

            updateStats();
            renderHabitStats();
        }

        // Add new habit
        function addHabit() {
            const input = document.getElementById('habitInput');
            const categorySelect = document.getElementById('habitCategory');
            const name = input.value.trim();
            const category = categorySelect.value || 'other';
            
            if (name) {
                habits.push({ name, completed: false, category });
                input.value = '';
                categorySelect.value = 'health'; // Reset to default
                saveData();
                renderHabits();
            }
        }

        // Add habit from suggestion
        function addSuggestion(habitName) {
            // Check if habit already exists
            const exists = habits.some(h => h.name.toLowerCase() === habitName.toLowerCase());
            if (exists) {
                // Give visual feedback that it already exists
                const input = document.getElementById('habitInput');
                input.value = habitName;
                input.focus();
                setTimeout(() => {
                    input.value = '';
                }, 1500);
                return;
            }
            
            // Auto-assign category
            let category = 'other';
            const lowerName = habitName.toLowerCase();
            if (['workout', 'swim', 'walk', 'water', 'sleep'].some(w => lowerName.includes(w))) category = 'health';
            else if (['read', 'journal', 'meditate', 'learn'].some(w => lowerName.includes(w))) category = 'mind';
            
            habits.push({ name: habitName, completed: false, category });
            saveData();
            renderHabits();
            
            // Visual feedback
            const input = document.getElementById('habitInput');
            input.value = `âœ“ Added "${habitName}"`;
            setTimeout(() => {
                input.value = '';
            }, 1000);
        }

        // Toggle habit completion
        function toggleHabit(index) {
            habits[index].completed = !habits[index].completed;
            saveData();
            renderHabits();
            renderBadges();
            checkAndShowInsight();
        }

        // Delete habit
        function deleteHabit(index) {
            if (confirm('Delete this habit?')) {
                habits.splice(index, 1);
                editingIndex = null;
                saveData();
                renderHabits();
            }
        }

        // Start editing a habit
        function startEditHabit(index) {
            editingIndex = index;
            renderHabits();
        }

        // Save edited habit
        function saveEditHabit(index) {
            const input = document.querySelector(`.habit-name-input[data-index="${index}"]`);
            if (input) {
                const newName = input.value.trim();
                if (newName && newName !== habits[index].name) {
                    habits[index].name = newName;
                    saveData();
                }
            }
            editingIndex = null;
            renderHabits();
        }

        // Reset day
        function resetDay() {
            if (confirm('Reset all habits for today? This will uncheck all completed habits.')) {
                habits = habits.map(h => ({ ...h, completed: false }));
                saveData();
                renderHabits();
            }
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Handle Enter key
        document.getElementById('habitInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addHabit();
            }
        });

        // Change stats period
        function changeStatsPeriod(days) {
            statsPeriod = days;
            
            // Update button states - only target stat period buttons
            document.querySelectorAll('.period-btn').forEach(btn => {
                if (parseInt(btn.dataset.period) === days) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            renderHabitStats();
        }

        // Change calendar month
        function changeMonth(delta) {
            calendarMonth += delta;
            
            if (calendarMonth > 11) {
                calendarMonth = 0;
                calendarYear++;
            } else if (calendarMonth < 0) {
                calendarMonth = 11;
                calendarYear--;
            }
            
            renderCalendar();
        }

        // Render monthly calendar
        function renderCalendar() {
            const weeklyData = getWeeklyData();
            const today = new Date();
            const currentMonthYear = new Date(calendarYear, calendarMonth, 1);
            
            // Update month/year display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('calendarMonthYear').textContent = 
                `${monthNames[calendarMonth]} ${calendarYear}`;
            
            // Update legend
            const legendText = document.querySelector('.calendar-legend .legend-item:first-child span');
            if (legendText) {
                legendText.textContent = `Goal Hit (${streakThreshold}%+)`;
            }
            
            const firstDay = new Date(calendarYear, calendarMonth, 1);
            const lastDay = new Date(calendarYear, calendarMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay(); // 0 = Sunday
            
            const container = document.getElementById('calendarGrid');
            let html = '';
            
            // Day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                html += `<div class="calendar-day-header">${day}</div>`;
            });
            
            // Empty cells before first day
            for (let i = 0; i < startingDayOfWeek; i++) {
                html += '<div class="calendar-day empty"></div>';
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(calendarYear, calendarMonth, day);
                const dateStr = date.toDateString();
                const data = weeklyData[dateStr];
                const percentage = data ? data.percentage : 0;
                
                const isToday = dateStr === today.toDateString();
                const isFuture = date > today;
                const isGoalHit = percentage >= streakThreshold;
                const isPartial = percentage > 0 && percentage < streakThreshold;
                
                let classes = 'calendar-day';
                if (isToday) classes += ' today';
                if (isFuture) classes += ' future';
                else if (isGoalHit) classes += ' goal-hit';
                else if (isPartial) classes += ' partial';
                
                const clickHandler = !isFuture && !isToday ? `onclick="openBackfillModal('${dateStr}')"` : '';
                
                html += `
                    <div class="${classes}" ${clickHandler}>
                        <div class="calendar-day-number">${day}</div>
                        ${!isFuture && data ? `<div class="calendar-day-percentage">${percentage}%</div>` : ''}
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        // Calculate habit statistics
        function calculateHabitStats() {
            const history = getHabitHistory();
            const backfillData = getBackfillData();
            const today = new Date();
            
            // Get current habit names
            const currentHabits = habits.map(h => h.name);
            const habitStats = {};
            
            // Initialize stats for current habits
            currentHabits.forEach(habitName => {
                habitStats[habitName] = {
                    completed: 0,
                    total: 0,
                    percentage: 0
                };
            });
            
            // Go through the selected period
            for (let i = 0; i < statsPeriod; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                
                // Get completed habits from history
                const completedOnDate = history[dateStr] || [];
                
                // Also check backfill data
                const backfilledHabits = backfillData[dateStr] || [];
                
                // Combine both sources
                const allCompletedOnDate = [...new Set([...completedOnDate, ...backfilledHabits])];
                
                // Count for each current habit
                currentHabits.forEach(habitName => {
                    if (habitStats[habitName]) {
                        habitStats[habitName].total++;
                        if (allCompletedOnDate.includes(habitName)) {
                            habitStats[habitName].completed++;
                        }
                    }
                });
            }
            
            // Calculate percentages
            Object.keys(habitStats).forEach(habitName => {
                const stat = habitStats[habitName];
                if (stat.total > 0) {
                    stat.percentage = Math.round((stat.completed / stat.total) * 100);
                }
            });
            
            return habitStats;
        }

        // Render habit statistics
        function renderHabitStats() {
            const container = document.getElementById('habitStatsContainer');
            
            if (habits.length === 0) {
                container.innerHTML = '<div class="no-stats">Add some habits to see performance stats!</div>';
                return;
            }
            
            const stats = calculateHabitStats();
            
            // Sort by percentage (descending)
            const sortedHabits = Object.entries(stats).sort((a, b) => b[1].percentage - a[1].percentage);
            
            if (sortedHabits.length === 0) {
                container.innerHTML = '<div class="no-stats">Start tracking to see your habit performance!</div>';
                return;
            }
            
            // Find best and worst performers
            const bestPercentage = sortedHabits[0][1].percentage;
            const worstPercentage = sortedHabits[sortedHabits.length - 1][1].percentage;
            
            container.innerHTML = sortedHabits.map(([habitName, stat], index) => {
                const isBest = stat.percentage === bestPercentage && stat.percentage > 0;
                const isLow = stat.percentage < 50;
                const trophy = isBest && sortedHabits.length > 1 ? '<span class="stats-trophy">ðŸ†</span>' : '';
                
                return `
                    <div class="habit-stat-item">
                        <div class="habit-stat-header">
                            <div class="habit-stat-name">${escapeHtml(habitName)}${trophy}</div>
                            <div class="habit-stat-percentage ${isLow ? 'low' : ''}">${stat.percentage}%</div>
                        </div>
                        <div class="habit-stat-bar-container">
                            <div class="habit-stat-bar ${isLow ? 'low' : ''}" style="width: ${stat.percentage}%"></div>
                        </div>
                        <div class="habit-stat-details">
                            <span class="habit-stat-count">${stat.completed} of ${stat.total} days</span>
                            <span class="habit-stat-count">${stat.total - stat.completed} missed</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Backfill functions
        function getBackfillData() {
            try {
                const stored = localStorage.getItem(BACKFILL_KEY);
                return stored ? JSON.parse(stored) : {};
            } catch (e) {
                console.error('Error loading backfill data:', e);
                return {};
            }
        }

        function saveBackfillData(dateStr, habitNames) {
            try {
                let backfillData = getBackfillData();
                backfillData[dateStr] = habitNames;
                localStorage.setItem(BACKFILL_KEY, JSON.stringify(backfillData));
            } catch (e) {
                console.error('Error saving backfill data:', e);
            }
        }

        function openBackfillModal(dateStr) {
            if (dateStr === currentDate) return;
            
            // Close calendar modal if open
            closeCalendarModal();
            
            backfillDate = dateStr;
            backfillSelections = [];
            
            const date = new Date(dateStr);
            const formattedDate = date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            document.getElementById('backfillTitle').textContent = `Backfill - ${formattedDate}`;
            
            const backfillData = getBackfillData();
            const existingData = backfillData[dateStr] || [];
            
            const container = document.getElementById('backfillHabits');
            container.innerHTML = habits.map((habit, index) => {
                const isSelected = existingData.includes(habit.name);
                if (isSelected) backfillSelections.push(index);
                
                return `
                    <div class="backfill-habit-item ${isSelected ? 'selected' : ''}" data-index="${index}" onclick="toggleBackfillHabit(${index})">
                        <div class="backfill-checkbox"></div>
                        <div class="backfill-habit-name">${escapeHtml(habit.name)}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('backfillModal').classList.add('active');
        }

        function closeBackfillModal() {
            document.getElementById('backfillModal').classList.remove('active');
            backfillDate = null;
            backfillSelections = [];
        }

        function openCalendarModal() {
            // Reset to current month when opening
            calendarMonth = new Date().getMonth();
            calendarYear = new Date().getFullYear();
            renderCalendar();
            document.getElementById('calendarModal').classList.add('active');
        }

        function closeCalendarModal() {
            document.getElementById('calendarModal').classList.remove('active');
        }

        function openBadgesModal() {
            renderBadges();
            document.getElementById('badgesModal').classList.add('active');
        }

        function closeBadgesModal() {
            document.getElementById('badgesModal').classList.remove('active');
        }

        function openReadmeModal() {
            document.getElementById('readmeModal').classList.add('active');
        }

        function closeReadmeModal() {
            document.getElementById('readmeModal').classList.remove('active');
        }

        function toggleBackfillHabit(index) {
            const item = document.querySelector(`.backfill-habit-item[data-index="${index}"]`);
            const selectionIndex = backfillSelections.indexOf(index);
            
            if (selectionIndex > -1) {
                backfillSelections.splice(selectionIndex, 1);
                item.classList.remove('selected');
            } else {
                backfillSelections.push(index);
                item.classList.add('selected');
            }
        }

        function saveBackfill() {
            if (!backfillDate) return;
            
            const selectedHabits = backfillSelections.map(index => habits[index].name);
            saveBackfillData(backfillDate, selectedHabits);
            
            const completed = backfillSelections.length;
            const total = habits.length;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            let weeklyData = getWeeklyData();
            weeklyData[backfillDate] = {
                percentage: percentage,
                completed: completed,
                total: total
            };
            localStorage.setItem(WEEKLY_KEY, JSON.stringify(weeklyData));
            
            // Also save to habit history for stats
            let history = getHabitHistory();
            history[backfillDate] = selectedHabits;
            localStorage.setItem(HABIT_HISTORY_KEY, JSON.stringify(history));
            
            closeBackfillModal();
            renderWeeklySummary();
            updateStreakDisplay();
            renderHabitStats();
            // Calendar will refresh when reopened
        }

        document.getElementById('backfillModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeBackfillModal();
            }
        });

        document.getElementById('calendarModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCalendarModal();
            }
        });

        document.getElementById('badgesModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeBadgesModal();
            }
        });

        document.getElementById('readmeModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeReadmeModal();
            }
        });

        // Toggle collapsible sections
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const icon = document.getElementById(sectionId.replace('Section', 'Icon'));
            if (section.classList.contains('open')) {
                section.classList.remove('open');
                icon.classList.remove('open');
            } else {
                section.classList.add('open');
                icon.classList.add('open');
            }
        }

        // â”€â”€â”€ ACHIEVEMENT BADGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const BADGE_DEFINITIONS = [
            {
                id: 'first_habit',
                icon: 'ðŸŒ±',
                name: 'First Step',
                desc: 'Add your first habit',
                check: () => habits.length >= 1
            },
            {
                id: 'on_fire',
                icon: 'ðŸ”¥',
                name: 'On Fire',
                desc: '100% completion for 3 days',
                check: () => {
                    const d = getWeeklyData();
                    const today = new Date();
                    let count = 0;
                    for (let i = 0; i < 30; i++) {
                        const dt = new Date(today);
                        dt.setDate(dt.getDate() - i);
                        const entry = d[dt.toDateString()];
                        if (entry && entry.percentage === 100) {
                            count++;
                            if (count >= 3) return true;
                        } else {
                            count = 0;
                        }
                    }
                    return false;
                }
            },
            {
                id: 'warrior_7',
                icon: 'ðŸ…',
                name: '7-Day Warrior',
                desc: '7-day streak',
                check: () => calculateStreaks().currentStreak >= 7
            },
            {
                id: 'diamond_30',
                icon: 'ðŸ’Ž',
                name: 'Diamond Habit',
                desc: '30-day streak',
                check: () => calculateStreaks().currentStreak >= 30
            },
            {
                id: 'perfect_week',
                icon: 'âš¡',
                name: 'Perfect Week',
                desc: '100% all 7 days this week',
                check: () => {
                    const d = getWeeklyData();
                    const today = new Date();
                    for (let i = 0; i < 7; i++) {
                        const dt = new Date(today);
                        dt.setDate(dt.getDate() - i);
                        const entry = d[dt.toDateString()];
                        if (!entry || entry.percentage < 100) return false;
                    }
                    return true;
                }
            },
            {
                id: 'habit_master',
                icon: 'ðŸ“‹',
                name: 'Habit Master',
                desc: 'Track 5+ habits at once',
                check: () => habits.length >= 5
            },
            {
                id: 'time_traveller',
                icon: 'ðŸ•°ï¸',
                name: 'Time Traveller',
                desc: 'Backfill a past day',
                check: () => Object.keys(getBackfillData()).length >= 1
            },
            {
                id: 'consistent',
                icon: 'ðŸ“ˆ',
                name: 'Consistent',
                desc: 'Best streak of 10+ days',
                check: () => calculateStreaks().bestStreak >= 10
            }
        ];

        function renderBadges() {
            const grid = document.getElementById('badgesGrid');
            if (!grid) return;
            grid.innerHTML = BADGE_DEFINITIONS.map(badge => {
                const unlocked = badge.check();
                return `
                    <div class="badge-card ${unlocked ? 'unlocked' : 'locked'}">
                        <div class="badge-icon">${badge.icon}</div>
                        <div class="badge-info">
                            <div class="badge-name">${badge.name}</div>
                            <div class="badge-desc">${badge.desc}</div>
                        </div>
                        <div class="badge-status">${unlocked ? 'âœ…' : 'ðŸ”’'}</div>
                    </div>
                `;
            }).join('');
        }

        // â”€â”€â”€ HABIT INSIGHTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let insightIndex = 0;
        let currentInsights = [];

        function generateInsights() {
            const weeklyData = getWeeklyData();
            const insights = [];
            const today = new Date();
            const dayNames = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];

            // Need at least 7 days of data for meaningful insights
            const entries = Object.entries(weeklyData);
            if (entries.length < 3 || habits.length === 0) return [];

            // â”€â”€ Day-of-week analysis â”€â”€
            const dayTotals = Array(7).fill(0);
            const dayCounts = Array(7).fill(0);
            entries.forEach(([dateStr, data]) => {
                if (data.total > 0) {
                    const dow = new Date(dateStr).getDay();
                    dayTotals[dow] += data.percentage;
                    dayCounts[dow]++;
                }
            });

            let worstDay = -1, worstPct = 101, bestDay = -1, bestPct = -1;
            for (let i = 0; i < 7; i++) {
                if (dayCounts[i] >= 2) {
                    const avg = dayTotals[i] / dayCounts[i];
                    if (avg < worstPct) { worstPct = avg; worstDay = i; }
                    if (avg > bestPct) { bestPct = avg; bestDay = i; }
                }
            }

            if (worstDay >= 0 && worstPct < 60) {
                insights.push({
                    text: `You tend to struggle on ${dayNames[worstDay]}s â€” try setting a smaller goal or a reminder for that day.`,
                    meta: `${dayNames[worstDay]} average: ${Math.round(worstPct)}% completion`
                });
            }

            if (bestDay >= 0 && bestPct > 70) {
                insights.push({
                    text: `${dayNames[bestDay]} is your strongest day â€” great momentum! Use that energy to prep for the week.`,
                    meta: `${dayNames[bestDay]} average: ${Math.round(bestPct)}% completion`
                });
            }

            // â”€â”€ Streak insight â”€â”€
            const { currentStreak, bestStreak } = calculateStreaks();
            if (currentStreak >= 3) {
                insights.push({
                    text: `You're on a ${currentStreak}-day streak â€” don't break the chain! ðŸ”¥`,
                    meta: `Your best ever: ${bestStreak} days`
                });
            } else if (currentStreak === 0 && bestStreak > 0) {
                insights.push({
                    text: `Your best streak was ${bestStreak} days â€” you've done it before, you can do it again!`,
                    meta: `Start fresh today to rebuild momentum`
                });
            }

            // â”€â”€ Last 7 days trend â”€â”€
            const last7 = [];
            for (let i = 6; i >= 0; i--) {
                const dt = new Date(today);
                dt.setDate(dt.getDate() - i);
                const entry = weeklyData[dt.toDateString()];
                if (entry && entry.total > 0) last7.push(entry.percentage);
            }
            if (last7.length >= 4) {
                const firstHalf = last7.slice(0, Math.floor(last7.length / 2));
                const secondHalf = last7.slice(Math.floor(last7.length / 2));
                const avg1 = firstHalf.reduce((a,b) => a+b, 0) / firstHalf.length;
                const avg2 = secondHalf.reduce((a,b) => a+b, 0) / secondHalf.length;
                if (avg2 - avg1 > 15) {
                    insights.push({
                        text: `You're trending upward this week â€” keep the momentum going! ðŸ“ˆ`,
                        meta: `Recent days avg: ${Math.round(avg2)}% vs earlier: ${Math.round(avg1)}%`
                    });
                } else if (avg1 - avg2 > 15) {
                    insights.push({
                        text: `Your completion rate has dipped lately. Try focusing on just 2-3 core habits today.`,
                        meta: `Recent days avg: ${Math.round(avg2)}% vs earlier: ${Math.round(avg1)}%`
                    });
                }
            }

            // â”€â”€ Habit-specific insight â”€â”€
            const stats = calculateHabitStats();
            const sorted = Object.entries(stats).sort((a,b) => a[1].percentage - b[1].percentage);
            if (sorted.length > 0) {
                const [worstHabit, worstStat] = sorted[0];
                if (worstStat.percentage < 50 && worstStat.total >= 5) {
                    insights.push({
                        text: `"${worstHabit}" is your toughest habit. Consider breaking it into a smaller action to build the trigger.`,
                        meta: `Completion rate: ${worstStat.percentage}% over ${worstStat.total} days`
                    });
                }
                const [bestHabit, bestStat] = sorted[sorted.length - 1];
                if (bestStat.percentage >= 80 && bestStat.total >= 5) {
                    insights.push({
                        text: `"${bestHabit}" is your strongest habit at ${bestStat.percentage}%! Use this as an anchor to stack new habits onto.`,
                        meta: `Completion: ${bestStat.completed} of ${bestStat.total} days`
                    });
                }
            }

            // â”€â”€ Motivational fallback â”€â”€
            if (insights.length === 0) {
                insights.push({
                    text: `Keep going! It takes an average of 66 days to form a habit. Every check-in counts. ðŸŒ±`,
                    meta: `Based on UCL research by Phillippa Lally`
                });
            }

            return insights;
        }

        function openInsightModal() {
            currentInsights = generateInsights();
            if (currentInsights.length === 0) return;
            insightIndex = 0;
            displayInsight();
            document.getElementById('insightModal').classList.add('active');
        }

        function displayInsight() {
            const insight = currentInsights[insightIndex];
            document.getElementById('insightModalText').textContent = insight.text;
            document.getElementById('insightModalMeta').textContent = insight.meta;
        }

        function showNextInsight() {
            insightIndex = (insightIndex + 1) % currentInsights.length;
            displayInsight();
        }

        function closeInsightModal() {
            document.getElementById('insightModal').classList.remove('active');
        }

        // Close insight on outside click
        document.getElementById('insightModal').addEventListener('click', function(e) {
            if (e.target === this) closeInsightModal();
        });

        // Show insight automatically when all habits are done for the day
        function checkAndShowInsight() {
            if (habits.length === 0) return;
            const allDone = habits.every(h => h.completed);
            if (allDone) {
                setTimeout(openInsightModal, 800);
            }
        }

        // â”€â”€â”€ SHARE PROGRESS CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function openShareModal() {
            renderShareCard();
            document.getElementById('shareModal').classList.add('active');
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('active');
        }

        function renderShareCard() {
            const weeklyData = getWeeklyData();
            const today = new Date();
            const { currentStreak } = calculateStreaks();
            
            // Calculate week average
            let weekTotal = 0, weekCount = 0;
            for (let i = 0; i < 7; i++) {
                const dt = new Date(today);
                dt.setDate(dt.getDate() - i);
                const entry = weeklyData[dt.toDateString()];
                if (entry && entry.total > 0) {
                    weekTotal += entry.percentage;
                    weekCount++;
                }
            }
            const weekAvg = weekCount > 0 ? Math.round(weekTotal / weekCount) : 0;
            
            document.getElementById('shareWeekPct').textContent = weekAvg + '%';
            document.getElementById('shareStreak').textContent = currentStreak + 'ðŸ”¥';
            
            // Render mini weekly grid
            const grid = document.getElementById('shareWeeklyGrid');
            const days = [];
            for (let i = 6; i >= 0; i--) {
                const dt = new Date(today);
                dt.setDate(dt.getDate() - i);
                const entry = weeklyData[dt.toDateString()];
                const pct = entry ? entry.percentage : 0;
                const dayName = dt.toLocaleDateString('en-US', { weekday: 'short' })[0];
                const goalHit = pct >= streakThreshold;
                days.push(`
                    <div class="share-day ${goalHit ? 'goal' : ''}">
                        <div class="share-day-name">${dayName}</div>
                        <div class="share-day-pct">${pct}%</div>
                    </div>
                `);
            }
            grid.innerHTML = days.join('');
        }

        function copyShareText() {
            const weekAvg = document.getElementById('shareWeekPct').textContent;
            const streak = document.getElementById('shareStreak').textContent;
            const text = `ðŸŽ¯ I hit ${weekAvg} completion this week on Daily Quest Tracker!\nðŸ”¥ Current streak: ${streak}\n\nTrack. Complete. Level Up. âš¡`;
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard! Share it anywhere ðŸš€');
            });
        }

        async function downloadShareCard() {
            const card = document.getElementById('shareCard');
            const downloadBtn = event.target;
            const originalText = downloadBtn.textContent;
            
            try {
                downloadBtn.textContent = 'â³ Generating...';
                downloadBtn.disabled = true;
                
                // Use html2canvas to convert the card to image
                const canvas = await html2canvas(card, {
                    scale: 2,
                    backgroundColor: '#1a1a35',
                    logging: false,
                    width: card.offsetWidth,
                    height: card.offsetHeight
                });
                
                // Convert to blob and download
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    const today = new Date().toISOString().split('T')[0];
                    a.href = url;
                    a.download = `DailyQuestTracker-${today}.png`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    downloadBtn.textContent = 'âœ… Downloaded!';
                    setTimeout(() => {
                        downloadBtn.textContent = originalText;
                        downloadBtn.disabled = false;
                    }, 2000);
                }, 'image/png');
                
            } catch (error) {
                console.error('Error generating image:', error);
                alert('Could not generate image. Please take a screenshot instead.');
                downloadBtn.textContent = originalText;
                downloadBtn.disabled = false;
            }
        }

        async function shareNative() {
            const card = document.getElementById('shareCard');
            const btn = event.target;
            const originalText = btn.textContent;
            
            try {
                btn.textContent = 'â³ Generating...';
                btn.disabled = true;
                
                const canvas = await html2canvas(card, {
                    scale: 2,
                    backgroundColor: '#1a1a35',
                    logging: false,
                    width: card.offsetWidth,
                    height: card.offsetHeight
                });
                
                canvas.toBlob(async function(blob) {
                    const file = new File([blob], 'DailyQuestTracker.png', { type: 'image/png' });
                    const shareData = {
                        files: [file],
                        title: 'My Daily Quest Progress',
                        text: `ðŸ”¥ ${calculateStreaks().currentStreak}-day streak on Daily Quest Tracker!`
                    };
                    
                    if (navigator.canShare && navigator.canShare(shareData)) {
                        await navigator.share(shareData);
                        btn.textContent = 'âœ… Shared!';
                    } else {
                        // Fallback to download
                        downloadShareCard();
                    }
                    
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.disabled = false;
                    }, 2000);
                }, 'image/png');
                
            } catch (error) {
                console.error('Share failed:', error);
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }

        // Show native share button if supported
        if (navigator.share && navigator.canShare) {
            const nativeBtn = document.getElementById('nativeShareBtn');
            if (nativeBtn) nativeBtn.style.display = 'inline-block';
        }

        document.getElementById('shareModal').addEventListener('click', function(e) {
            if (e.target === this) closeShareModal();
        });

        // â”€â”€â”€ THEME TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function loadTheme() {
            const saved = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', saved);
            document.getElementById('themeIcon').textContent = saved === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
        }

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme') || 'dark';
            const next = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            document.getElementById('themeIcon').textContent = next === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
            localStorage.setItem('theme', next);
        }

        // Initialize app
        loadTheme();
        updateDateDisplay();
        loadStreakThreshold();
        loadData();
        renderHabits();
        renderWeeklySummary();
        updateStreakDisplay();
        renderHabitStats();

        // Update calendar legend with current threshold
        function updateCalendarLegend() {
            const legendText = document.querySelector('.calendar-legend .legend-item:first-child span');
            if (legendText) {
                legendText.textContent = 'Goal Hit (' + streakThreshold + '%+)';
            }
        }
        updateCalendarLegend();

        // â”€â”€â”€ PWA SERVICE WORKER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE = 'dqt-v1';
                const ASSETS = [self.location.href];

                self.addEventListener('install', e => {
                    e.waitUntil(
                        caches.open(CACHE).then(cache => cache.addAll(ASSETS))
                    );
                    self.skipWaiting();
                });

                self.addEventListener('activate', e => {
                    e.waitUntil(
                        caches.keys().then(keys =>
                            Promise.all(keys.filter(k => k !== CACHE).map(k => caches.delete(k)))
                        )
                    );
                    self.clients.claim();
                });

                self.addEventListener('fetch', e => {
                    e.respondWith(
                        caches.match(e.request).then(cached => cached || fetch(e.request))
                    );
                });
            `;
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            navigator.serviceWorker.register(swUrl).catch(() => {});
        }

        // â”€â”€â”€ INSTALL PROMPT BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let deferredPrompt = null;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallBanner();
        });

        function showInstallBanner() {
            if (document.getElementById('installBanner')) return;
            const banner = document.createElement('div');
            banner.id = 'installBanner';
            banner.innerHTML = `
                <div class="install-banner-content">
                    <span class="install-banner-icon">âš¡</span>
                    <div class="install-banner-text">
                        <strong>Add to Home Screen</strong>
                        <span>Install Daily Quest Tracker as an app</span>
                    </div>
                    <button class="install-btn" onclick="installApp()">Install</button>
                    <button class="install-dismiss" onclick="dismissBanner()">âœ•</button>
                </div>
            `;
            document.body.appendChild(banner);
            setTimeout(() => banner.classList.add('visible'), 100);
        }

        function installApp() {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then(() => {
                deferredPrompt = null;
                dismissBanner();
            });
        }

        function dismissBanner() {
            const banner = document.getElementById('installBanner');
            if (banner) {
                banner.classList.remove('visible');
                setTimeout(() => banner.remove(), 400);
            }
        }

        // iOS Safari - show manual instructions since it doesn't support beforeinstallprompt
        function isIos() {
            return /iphone|ipad|ipod/i.test(navigator.userAgent);
        }
        function isInStandaloneMode() {
            return ('standalone' in navigator) && navigator.standalone;
        }
        if (isIos() && !isInStandaloneMode()) {
            const shown = localStorage.getItem('ios-install-shown');
            if (!shown) {
                setTimeout(showIosBanner, 3000);
                localStorage.setItem('ios-install-shown', '1');
            }
        }

        function showIosBanner() {
            if (document.getElementById('installBanner')) return;
            const banner = document.createElement('div');
            banner.id = 'installBanner';
            banner.innerHTML = `
                <div class="install-banner-content">
                    <span class="install-banner-icon">âš¡</span>
                    <div class="install-banner-text">
                        <strong>Add to Home Screen</strong>
                        <span>Tap <strong>Share</strong> â†’ <strong>Add to Home Screen</strong></span>
                    </div>
                    <button class="install-dismiss" onclick="dismissBanner()">âœ•</button>
                </div>
            `;
            document.body.appendChild(banner);
            setTimeout(() => banner.classList.add('visible'), 100);
        }
    </script>
</body>
</html>
